%h1 Listing diagnostics
- if check_admin(current_user)
  = link_to 'New Diagnostic', new_diagnostic_path, class: 'btn'
%table.table
  %tr
    %th.keep-left2 Name
    %th.keep-left3 Description
    %th
  -@diagnostics.each do |diagnostic|
    -sum = 0
    -complete = 0
    -diagnostic.segments.each do |seg|
      -segment = seg.class.where(diagnostic_id: diagnostic.id, id: seg.id).first
      -segment.questions.each do |que|
        -question = que.class.where(segment_id: segment.id, id: que.id).first
        -question.sub_questions.each do |sub|
          -sub_question = sub.class.where(question_id: question.id, id: sub.id).first
          -sum += 1
          -if sub_question.yes?(current_user) || sub_question.no?(current_user)
            -complete += 1
            
    %tr.section{ :'data-animation' => :true, :'data-trigger' => :hover, :'data-html' => :true, :'data-title' => "Percent Complete", :'data-content' => "#{percent_completed(complete, sum)}%"}
      %td= link_to diagnostic.name, diagnostic_path(diagnostic)
      %td= diagnostic.description
      %td.pulltoright
        %span.admin
          - if check_admin(current_user)
            = link_to 'Edit Content', diagnostic_admin_path(diagnostic), id: 'show-content', data: { diagnostic_id: diagnostic.id }
            |
            \#{link_to 'Edit Name and Description', edit_diagnostic_path(diagnostic)}
            |
            \#{link_to 'Delete', diagnostic, method: :delete, data: { confirm: 'Are you sure? This will delete all the content of this diagnostic.' }}
          - else
            = link_to 'Show Content', diagnostic_admin_path(diagnostic), id: 'show-content', data: { diagnostic_id: diagnostic.id }